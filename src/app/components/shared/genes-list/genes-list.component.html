<app-search
  *ngIf="showSearch"
  [dataSource]="inputData"
  (dataSourceChange)="updateGeneListOnTyping($event)"
  (isGoModeTriggered)="toggleGoSearchMode($event)"
  (isGoSearchTriggered)="searchGenesByGoTerm($event)"
></app-search>

<ng-container
  *ngIf="
    (isGoTermsMode && isGoSearchPerformed && !isGoTermsModeError) ||
    (!isGoTermsMode && searchedData?.length !== 0)
  "
>
  <!-- Filters -->
  <div *ngIf="showFiltersPanel" class="view-panel">
    <div class="filters-group view-panel__filters">
      <button
        class="filter"
        (click)="sortBy('name')"
        [class.__active]="filters.byName"
      >
        {{ "main_page_table_name" | translate }}
        <span class="fa far fa-sort-down"></span>
      </button>

      <button
        class="filter"
        (click)="sortBy('age')"
        [class.__active]="filters.byAge"
      >
        {{ "age" | translate }} ({{ "million_years" | translate }})
        <span class="fa far fa-sort-down"></span>
      </button>

      <button
        *ngIf="filters.byClasses.length > 0"
        class="filter __active"
        (click)="clearFilters(filterTypes.classes)"
      >
        {{ "functional_classes" | translate }}
        <span class="fa fal fa-times"></span>
      </button>

      <button
        *ngIf="filters.byExpressionChange"
        class="filter __active"
        (click)="clearFilters(filterTypes.expressionChange)"
      >
        {{ "main_page_table_expression" | translate }}
        <span class="fa fal fa-times"></span>
      </button>

      <button
        *ngIf="filters.byDisease"
        class="filter __active"
        (click)="clearFilters(filterTypes.disease)"
      >
        {{ "gene_list_diseases" | translate }}
        <span class="fa fal fa-times"></span>
      </button>

      <button
        *ngIf="filters.byDiseaseCategories"
        class="filter __active"
        (click)="clearFilters(filterTypes.diseaseCategories)"
      >
        {{ "gene_list_disease_categories" | translate }}
        <span class="fa fal fa-times"></span>
      </button>

      <button
        *ngIf="filters.bySelectionCriteria"
        class="filter __active"
        (click)="clearFilters(filterTypes.criteria)"
      >
        {{ "main_page_table_criteria" | translate }}
        <span class="fa fal fa-times"></span>
      </button>

      <button
        class="btn btn--small btn--purple"
        (click)="clearFilters()"
        *ngIf="isClearFiltersBtnShown"
      >
        <span class="fa far fa-times"></span> {{ "filters_reset" | translate }}
      </button>

      <button *ngIf="!isGoTermsMode"
              class="btn btn--small btn--fill btn--purple"
              (click)="openFiltersModal()">
        <span class="fa far fa-plus"></span>
        {{ 'filters_modal_title' | translate }}
      </button>
    </div>

    <div class="view-panel__buttons">
      <a class="btn btn--small btn--purple"
        [href]="downloadJsonLink"
        target="_blank"
        download="export.json"
      >
        <span class="fa far fa-download"></span> JSON
      </a>

      <button
        *ngIf="!isMobile"
        class="toggler __ml-10"
        (click)="toggleGenesView()"
        [ngClass]="asTableRow ? 'toggler--def' : 'toggler--alt'"
        matTooltip="{{ 'gene_list_view' |translate }}"
      >
        <span class="fa far fa-table toggler__icon toggler__icon--def"></span>
        <span
          class="fa far fa-th-large toggler__icon toggler__icon--alt"
        ></span>
      </button>
    </div>
  </div>

  <!-- Content -->
  <section
    class="view-content notranslate"
    [ngClass]="
      asTableRow && !isMobile
        ? 'view-content--as-table'
        : 'view-content--as-cards'
    "
  >
    <!-- Content views -->
    <table *ngIf="asTableRow && !isMobile">
      <thead>
        <app-genes-table-header
          [settings]="listSettings"
          [isGoTermsMode]="isGoTermsMode"
        ></app-genes-table-header>
      </thead>


      <app-gene-table-row *ngFor="let rowData of searchedData | slice: 0:loadedGenesQuantity"
                          [isGoTermsMode]="isGoTermsMode"
                          [goModeCellData]="goModeCellData"
                          [listSettings]="listSettings"
                          [item]="rowData"
                          (expressionChangeId)="filterByExpressionChange($event)"
                          (funcClusterId)="filterByFuncClusters($event)"
                          (methylationChange)="filterByMethylationChange($event)"
                          (diseaseName)="filterByDisease($event)"
                          (diseaseCategories)="filterByDiseaseCategories($event)"
                          (selectionCriteria)="filterBySelectionCriteria($event)">

      </app-gene-table-row>
    </table>

    <ng-container *ngIf="!asTableRow || isMobile">
      <app-genes-card class="card" *ngFor="let rowData of searchedData | slice: 0:loadedGenesQuantity"
                      [isGoTermsMode]="isGoTermsMode"
                      [goModeCellData]="goModeCellData"
                      [listSettings]="listSettings"
                      [item]="rowData"
                      (expressionChangeId)="filterByExpressionChange($event)"
                      (funcClusterId)="filterByFuncClusters($event)"
                      (methylationChange)="filterByMethylationChange($event)"
                      (diseaseName)="filterByDisease($event)"
                      (diseaseCategories)="filterByDiseaseCategories($event)"
                      (selectionCriteria)="filterBySelectionCriteria($event)"></app-genes-card>
    </ng-container>
  </section>
  <!-- / Content views -->

  <div
    class="btn-wrap show-more"
    *ngIf="searchedData?.length > loadedGenesQuantity">

    <button (click)="loadMoreGenes()" class="btn show-more__button">
      {{ "show_more" | translate }}
    </button>
  </div>
</ng-container>

<!-- No content error message -->
<section
  *ngIf="
    (isGoTermsMode && isGoSearchPerformed && searchedData?.length == 0) ||
    (!isGoTermsMode && searchedData?.length == 0)
  "
  class="no-content"
>
  <div class="no-content__inner">
    <div class="no-content__icon no-content__icon-standard"></div>
    <div class="no-content__title">
      <div class="title__center">
        {{ "nothing_found" | translate }}
      </div>
    </div>
  </div>
</section>

<!-- GO search mode start message -->
<section *ngIf="isGoTermsMode && !isGoSearchPerformed" class="no-content">
  <div class="no-content__inner">
    <div class="no-content__icon no-content__icon-standard"></div>
    <div class="no-content__title">
      <div class="title__center">
        {{ "go_results_start_typing" | translate }}
      </div>
    </div>
  </div>
</section>


<ng-template #filtersModalBody>
  <div class="filters-modal__header" mat-dialog-title>
    {{ 'filters_modal_title' | translate }}
    <button mat-icon-button
            class="close-button"
            (click)="closeFiltersModal()"
            aria-label="Закрыть">
      <span class="fa fal fa-times"></span>
    </button>
  </div>
  <div class="filters-modal__body">
    <mat-checkbox
      color="primary"
      (change)="changeGenesListSettings('gene-age')"
      [checked]="listSettings.ifShowAge"
    >{{ "gene_list_evolutionary_age" | translate }}
    </mat-checkbox>
    <mat-checkbox
      color="primary"
      (change)="changeGenesListSettings('classes')"
      [checked]="listSettings.ifShowClasses"
    >{{ "functional_classes" | translate }}
    </mat-checkbox>
    <mat-checkbox
      color="primary"
      [checked]="listSettings.ifShowExpression"
      (change)="changeGenesListSettings('expression')"
    >{{ "main_page_table_expression" | translate }}
    </mat-checkbox>
    <mat-checkbox
      color="primary"
      [checked]="listSettings.ifShowDiseases"
      (change)="changeGenesListSettings('diseases')">
      {{ "gene_list_diseases" | translate }}
    </mat-checkbox>
    <mat-checkbox
      color="primary"
      [checked]="listSettings.ifShowDiseaseCategories"
      (change)="changeGenesListSettings('disease-categories')">
      {{ "gene_list_disease_categories" | translate }}
    </mat-checkbox>
    <mat-checkbox
      color="primary"
      [checked]="listSettings.ifShowCriteria"
      (change)="changeGenesListSettings('criteria')">
      {{ "main_page_table_criteria" | translate }}
    </mat-checkbox>
  </div>
</ng-template>
