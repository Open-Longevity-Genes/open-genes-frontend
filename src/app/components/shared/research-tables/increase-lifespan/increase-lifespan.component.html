<section>
  <h4>{{ "gene_page_researches_lifespan" | translate }}</h4>

  <div class="table-section __mt-20 __w-content-fluid">
    <table class="table table--zebra">
      <thead>
      <tr>
        <th *ngIf="geneColumnOn"
            rowspan="2">
          {{ "main_page_table_name" | translate }}
        </th>
        <th colspan="4">
          {{ "researches_l_cohort_data" | translate }}
        </th>
        <th colspan="3">
          {{ "researches_l_containment_conditions" | translate }}
        </th>
        <th colspan="4">
          <!-- TODO: так не надо было делать, но пока получается только так -->
          {{ "researches_l_control_and_experiment" | translate }}
        </th>
        <th colspan="5">
          {{ "researches_l_experiment" | translate }}
        </th>
        <th colspan="7">{{ "researches_result" | translate }}</th>
        <th rowspan="2">
          {{ "researches_comment" | translate }}
        </th>
      </tr>
      <tr>
        <th>
          {{ "researches_model_organism" | translate }}
        </th>
        <th>
          {{ "researches_sex" | translate }}
        </th>
        <th>
          {{ "researches_line" | translate }}
        </th>
        <th class="__cell-width-medium">
          {{ "researches_l_cohort_size" | translate }}
        </th>
        <th class="__cell-width-small">
          {{ "researches_l_temperature_title" | translate }}
        </th>
        <th>
          {{ "researches_l_density" | translate }}
        </th>
        <th>
          {{ "researches_l_diet" | translate }}
        </th>

        <th>
          {{ "researches_l_intervention_way" | translate }}
        </th>
        <th>
          {{ "researches_l_intervention_method" | translate }}
        </th>
        <th>
          {{ "researches_genotype" | translate }}
        </th>
        <th>
          {{ "researches_l_drug_withdrawal" | translate }}
        </th>

        <th>{{ "researches_l_tissue_specificity" | translate }}</th>
        <th>
          {{ "researches_l_intervention_way" | translate }}
        </th>
        <th>
          {{ "researches_l_intervention_method" | translate }}
        </th>
        <th>
          {{ "researches_genotype" | translate }}
        </th>
        <th class="__cell-width-large">
          {{ "researches_l_drug_withdrawal" | translate }}
        </th>

        <th class="__cell-width-small">
          {{ "researches_l_main_effect_of_intervention" | translate }}
        </th>
        <th class="__cell-width-small">
          {{ "researches_l_main_effect_on_lifespan" | translate }}
        </th>
        <th>{{ "researches_l_experiment_lifespan" | translate }}</th>
        <th>{{ "researches_l_control_lifespan" | translate }}</th>
        <th>{{ "researches_l_target_gene_expression" | translate }}</th>
        <th class="__cell-width-medium">{{ "researches_l_lifespan_percent" | translate }}</th>
        <th class="__cell-width-large">{{ "researches_l_other_results" | translate }} </th>
      </tr>
      </thead>
      <tbody>
      <ng-container *ngFor="let r of items; let i = index">
        <tr *ngIf="!hasAdditionalInterventions(r)">
          <td *ngIf="geneColumnOn"
              class="__cell-width-medium">
            <div *ngIf="r.hasOwnProperty('geneSymbol')"
                 class="title">
              <a [routerLink]="['/gene', r.geneSymbol]" class="link link--gray">
                <b>{{ r.geneSymbol }}</b> {{ r.geneName }}
              </a>
            </div>
          </td>
          <td>
            {{ r.modelOrganism || "—" }}
          </td>
          <td>
            {{ r.sex || "—" }}
          </td>
          <td>
            {{ r.organismLine || "—" }}
          </td>
          <td>
            <ng-container *ngIf="r.controlCohortSize || r.experimentCohortSize else dash">
              <p *ngIf="r.controlCohortSize">
                {{ "researches_l_control" | translate: { data: r.controlCohortSize } }}
              </p>
              <p *ngIf="r.experimentCohortSize">
                {{ "researches_l_experiment" | translate }}: {{ r.experimentCohortSize }}
              </p>
            </ng-container>
          </td>
          <td>
            <ng-container *ngIf="r.temperatureFrom; else dash">
              {{ "researches_l_temperature" | translate: { from: r.temperatureFrom, to: r.temperatureTo } }}
            </ng-container>
          </td>
          <td>
            <ng-container *ngIf="r.populationDensity && r.populationDensity !== 0; else dash">
              {{ "researches_l_density" | translate: { data: r.populationDensity } }}
            </ng-container>
          </td>
          <td>
            <ng-container *ngIf="r.diet?.length !== 0; else dash">
              {{ r.diet }}
            </ng-container>
          </td>

          <!-- Control & experiment data -->
          <ng-container *ngIf="r.interventions.controlAndExperiment?.length !== 0; else interventionEmptyFields">
            <ng-container *ngFor="let sample of r.interventions.controlAndExperiment"
                          [ngTemplateOutlet]="interventionFields"
                          [ngTemplateOutletContext]="{sample: sample}">
            </ng-container>
          </ng-container>

          <td>
            <ng-container *ngFor="let sample of r.interventions.experiment">
              <!-- Tissue specificity can only be in experiment group if  -->
              <ng-container *ngIf="sample.tissueSpecific; else notTissueSpecific">
                <p>{{ "researches_promoter" | translate }}: {{ sample.tissueSpecificPromoter }}</p>
                <ul *ngIf="sample.tissues.length !== 0"
                    class="list">
                  <li *ngFor="let tissue of sample.tissues">
                    {{ tissue.name }}
                  </li>
                </ul>
              </ng-container>
            </ng-container>
          </td>

          <!-- Experiment data -->
          <ng-container *ngIf="r.interventions.experiment?.length !== 0; else interventionEmptyFields">
            <ng-container *ngFor="let sample of r.interventions.experiment"
                          [ngTemplateOutlet]="interventionFields"
                          [ngTemplateOutletContext]="{sample: sample}">
            </ng-container>
          </ng-container>

          <td>
            <ng-container *ngFor="let sample of r.interventions.experiment">
              <!-- Experiment main effect can only be in experiment group  -->
              <ng-container *ngIf="sample.experimentMainEffect; else dash">
                <p>{{ sample.experimentMainEffect }}</p>
              </ng-container>
            </ng-container>
          </td>

          <td>
          <ng-container *ngIf="r.interventionResultForLifespan; else dash">
            {{ r.interventionResultForLifespan }}
          </ng-container>
          </td>

          <td>
            <!-- TODO: оставлять подписи "Мин", "Макс" и т. д. чтобы не было прочерков без подписей -->
            <p *ngIf="r.lifespanMinExperiment; else dash">
              {{ "researches_l_min" | translate: {
              data: r.lifespanMinExperiment,
              unit: r.lifespanTimeUnit ? r.lifespanTimeUnit : ''
            } }}
            </p>
            <p *ngIf="r.lifespanMeanExperiment; else dash">
              {{ "researches_l_mean" | translate: {
              data: r.lifespanMeanExperiment,
              unit: r.lifespanTimeUnit ? r.lifespanTimeUnit : ''
            } }}
            </p>
            <p *ngIf="r.lifespanMedianExperiment; else dash">
              {{ "researches_l_median" | translate: {
              data: r.lifespanMedianExperiment,
              unit: r.lifespanTimeUnit ? r.lifespanTimeUnit : ''
            } }}
            </p>
            <p *ngIf="r.lifespanMaxExperiment; else dash">
              {{ "researches_l_max" | translate: {
              data: r.lifespanMaxExperiment,
              unit: r.lifespanTimeUnit ? r.lifespanTimeUnit : ''
            } }}
            </p>
          </td>
          <td>
            <p *ngIf="r.lifespanMinControl; else dash">
              {{ "researches_l_min" | translate: {
              data: r.lifespanMinControl,
              unit: r.lifespanTimeUnit ? r.lifespanTimeUnit : ''
            } }}
            </p>
            <p *ngIf="r.lifespanMeanControl; else dash">
              {{ "researches_l_mean" | translate: {
              data: r.lifespanMeanControl,
              unit: r.lifespanTimeUnit ? r.lifespanTimeUnit : ''
            } }}
            </p>
            <p *ngIf="r.lifespanMedianControl; else dash">
              {{ "researches_l_median" | translate: {
              data: r.lifespanMedianControl,
              unit: r.lifespanTimeUnit ? r.lifespanTimeUnit : ''
            } }}
            </p>
            <p *ngIf="r.lifespanMaxControl; else dash">
              {{ "researches_l_max" | translate: {
              data: r.lifespanMaxControl,
              unit: r.lifespanTimeUnit ? r.lifespanTimeUnit : ''
            } }}
            </p>
          </td>
          <td>
            <ng-container *ngIf="r.expressionChangePercent && r.expressionChangePercent !== 0; else dash">
              {{ r.expressionChangePercent }}%
            </ng-container>
          </td>
          <td>
            <p *ngIf="r.lifespanMinChangePercent; else dash">
              {{ "researches_l_min" | translate: { data: r.lifespanMinChangePercent, unit: "%" } }}, <br>
              {{ "researches_l_significance" | translate: { data: r.lMinChangeStatSignificance | trueFalseNull | translate } }}
            </p>
            <p *ngIf="r.lifespanMeanChangePercent; else dash">
              {{ "researches_l_mean" | translate: { data: r.lifespanMeanChangePercent, unit: "%" } }}, <br>
              {{ "researches_l_significance" | translate: { data: r.lMeanChangeStatSignificance | trueFalseNull | translate } }}
            </p>
            <p *ngIf="r.lifespanMedianChangePercent; else dash">
              {{ "researches_l_median" | translate: { data: r.lifespanMedianChangePercent, unit: "%" } }}, <br>
              {{ "researches_l_significance" | translate: { data: r.lMedianChangeStatSignificance | trueFalseNull | translate } }}
            </p>
            <p *ngIf="r.lifespanMaxChangePercent; else dash">
              {{ "researches_l_max" | translate: { data: r.lifespanMaxChangePercent, unit: "%" } }}, <br>
              {{ "researches_l_significance" | translate: { data: r.lMaxChangeStatSignificance | trueFalseNull | translate } }}
            </p>
          </td>

          <td>
            <ng-container
              *ngIf="r?.interventionDeteriorates?.length !== 0 || r?.interventionImproves?.length !== 0;
              else dash">
              <ng-container *ngIf="r?.interventionDeteriorates.length !== 0">
                <h6>{{ "researches_deteriorates" | translate }}</h6>
                <ul class="list list--bulletted">
                  <li *ngFor="let result of r.interventionDeteriorates">
                    {{ result.name }}
                  </li>
                </ul>
              </ng-container>

              <ng-container *ngIf="r?.interventionImproves.length !== 0">
                <h6>{{ "researches_improves" | translate }}</h6>
                <ul class="list list--bulletted">
                  <li *ngFor="let result of r.interventionImproves">
                    {{ result.name }}
                  </li>
                </ul>
              </ng-container>
            </ng-container>
          </td>

          <td>
            <button class="btn btn--small btn--purple btn--flat"
                    (click)="openCommentModal('researches_comment', r, links)"
            >
              {{ "researches_comment_button" | translate }}
            </button>
          </td>
        </tr>
      </ng-container>
      </tbody>
    </table>
  </div>
</section>


<ng-template #dash>
  <span class="table__dash"></span>
</ng-template>

<ng-template #notTissueSpecific>
  <p class="table__placeholder">{{ "researches_l_not_tissue_specific" | translate }}</p>
</ng-template>

<ng-template #links let-item="item">
  <p *ngIf="item?.comment.length !== 0">
    {{ item?.comment }}
  </p>

  <p *ngIf="item?.doi !== ''">
    <a
      href="https://doi.org/{{ item?.doi }}"
      class="link"
      target="_blank"
    >{{ item?.doi }}</a>
  </p>
  <p *ngIf="item?.pmid !== ''">
    <a
      href="https://pubmed.ncbi.nlm.nih.gov/17170002/{{ item?.pmid }}"
      class="link"
      target="_blank"
    >{{ item?.pmid }}</a>
  </p>

  <app-publication-info *ngIf="item?.doi"
                        [doi]="item.doi"
                        class="publication-info"
  ></app-publication-info>
</ng-template>

<ng-template #interventionEmptyFields>
  <td>
    <span class="table__dash"></span>
  </td>
  <td>
    <span class="table__dash"></span>
  </td>
  <td>
    <span class="table__dash"></span>
  </td>
  <td>
    <span class="table__dash"></span>
  </td>
</ng-template>

<ng-template let-sample="sample" #interventionFields>
  <td>
    {{ sample.interventionWay || "—" }}
  </td>
  <td>
    {{ sample.interventionMethod  || "—" }}
  </td>
  <td>
    {{ sample.genotype  || "—" }}
  </td>
  <td>
    <ng-container *ngIf="sample.inductionByDrugWithdrawal; else dash">
      <p *ngIf="sample.drug">
        {{ "researches_l_drug" | translate:{ data: sample.drug } }}
      </p>
      <p *ngIf="sample.drugDeliveryWay">
        {{ "researches_l_drug_delivery" | translate:{ data: sample.drugDeliveryWay } }}
      </p>
      <!-- TODO: сначала посмотреть пример -->
      <p>Treatment period: <br>
        {{sample.treatmentPeriod}} <br>
        {{sample.treatmentStart}} {{sample.startTimeUnit}} on {{sample.startStageOfDevelopment}} stage <br>
        {{sample.treatmentEnd}} {{sample.endTimeUnit}} on {{sample.endStageOfDevelopment}} stage
      </p>
      <p>
        {{ sample.treatmentDescription }}
      </p>
    </ng-container>
  </td>
</ng-template>