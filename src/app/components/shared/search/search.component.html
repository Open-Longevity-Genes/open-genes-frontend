<form [formGroup]="searchForm"
      class="search-form"
      [class.search-form--active]="showSearchResult">

  <div class="search-form__quantity">
    <span *ngIf="genesList?.length">{{ 'main_page_total' | translate: { number: genesList?.length } }}</span>
  </div>

  <div *ngIf="showSearchResult"
       class="search-backdrop"
       (click)="cancelSearch($event)"
  ></div>

  <div class="search-form__panel">
    <button
      (click)="cancelSearch($event)"
      class="btn btn--purple btn--icon-only cancel-search-button">
      <span class="fa fal fa-arrow-left"></span>
    </button>

    <div class="search-form__wrapper">
      <button
        mat-icon-button
        class="search-form__submit search-form__submit--active"
        type="submit"
        (click)="onSearch()">
        <span class="fa fal fa-search"></span>
      </button>

      <button
        [matMenuTriggerFor]="searchMenu"
        class="search-form__switch"
        [matTooltip]="(isGoSearchMode ? 'search_for_go_terms' : 'search_for_functions') | translate">
        <span
          [ngClass]="isGoSearchMode ? 'fa-book' : 'fa-dna'"
          class="fa far"></span>
        <span class="fa far fa-sort-down"></span>
      </button>

      <!-- TODO: Use matNativeControl -->
      <input
        formControlName="searchField"
        type="text"
        placeholder="{{ (isGoSearchMode ? 'search_field_tap_search' : 'search_field_start_typing') | translate }}"
        class="field search-form__field"
        (keyup.enter)="onSearch()"
        #searchQuery
      >

      <mat-menu #searchMenu>
        <button mat-menu-item
                (click)="setGoSearchMode()"
                [disabled]="!isGoSearchMode">
          <span class="fa fal fa-dna __mr-5"></span> {{ 'search_for_functions' | translate }}
        </button>
        <button mat-menu-item
                (click)="setGoSearchMode()"
                [disabled]="isGoSearchMode">
          <span class="fa fal fa-book __mr-5"></span> {{ 'search_for_go_terms' | translate }}
        </button>
      </mat-menu>

    </div>

    <div class="search-form__autocomplete-list"
         *ngIf="showSearchResult">

      <div class="search-form__genes-info">
        <div class="genes-info__found" *ngIf="foundGenes.length">
          Найдено: {{foundGenes.length}}
          (<ng-container *ngFor="let geneName of foundGenes; let last = last">
            {{geneName}} <span *ngIf="foundGenes.length > 1 && !last">, </span>
          </ng-container>)
        </div>
        <div class="genes-info__not-found" *ngIf="notFoundGenes.length">
          Не найдено: {{notFoundGenes.length}}
          (<ng-container *ngFor="let geneName of notFoundGenes;  let last = last">
            {{geneName}} <span *ngIf="notFoundGenes.length > 1 && !last">, </span>
          </ng-container>)
        </div>
      </div>

      <ng-container *ngFor="let gene of searchedData; let i = index">
        <button
          *ngIf="i < 5"
          class="search-form__autocomplete-item"
          tabindex="0"
          [routerLink]="['/gene', gene.symbol]">

          <span class="item__symbol"
                appHighlight
                [highlightText]="searchQuery.value"
                [innerHTML]="gene.symbol">
          </span>&nbsp;
          <span *ngIf="!gene?.terms"
                class="item__name"
                appHighlight
                [highlightText]="searchQuery.value"
                [innerHTML]="gene.name">
          </span>&nbsp;

          <ng-container *ngIf="biologicalProcess?.size !== 0">
            <span *ngFor="let term of biologicalProcess | keyvalue"
                  class="item__name"
                  appHighlight
                  [highlightText]="searchQuery.value"
                  [innerHTML]="term.value">
          </span>
          </ng-container>

          <ng-container *ngIf="cellularComponent?.size !== 0">
            <span *ngFor="let term of cellularComponent | keyvalue"
                  class="item__name"
                  appHighlight
                  [highlightText]="searchQuery.value"
                  [innerHTML]="term.value">
          </span>
          </ng-container>

          <ng-container *ngIf="molecularActivity?.size !== 0">
            <span *ngFor="let term of molecularActivity | keyvalue"
                  class="item__name"
                  appHighlight
                  [highlightText]="searchQuery.value"
                  [innerHTML]="term.value">
          </span>
          </ng-container>
        </button>
      </ng-container>
    </div>
  </div>
</form>


